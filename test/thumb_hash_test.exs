defmodule ThumbHashTest do
  use ExUnit.Case
  doctest ThumbHash

  test "generates a hash of an image" do
    waves = Path.join(__DIR__, "waves.jpg")
    waves_hash = "b8cJJIpJdnZaeIiQho1pf6b3Vg=="
    assert ThumbHash.generate_base64_hash!(waves) == waves_hash
  end

  test "generates a hash of an image with an alpha channel" do
    alpha_image = Path.join(__DIR__, "with-alpha.png")
    hash = "EmmOI4oPgod/h5egexP4ZwAAh4eIeIg="
    assert ThumbHash.generate_base64_hash!(alpha_image) == hash
  end

  test "generates a representative inline image from a hash" do
    waves_hash = "b8cJJIpJdnZaeIiQho1pf6b3Vg=="
    waves_inline = "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"

    assert ThumbHash.generate_inline_image!(waves_hash) == waves_inline
  end

  test "generates a representative inline image from a hash (with alpha)" do
    alpha_hash = "EmmOI4oPgod/h5egexP4ZwAAh4eIeIg="
    alpha_inline = "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"

    assert ThumbHash.generate_inline_image!(alpha_hash) == alpha_inline
  end
end
